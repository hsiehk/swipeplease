<!DOCTYPE html>
<!-- saved from url=(0037)https://hsiehk.github.io/swipeplease/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body class="vsc-initialized">
<h1 id="Welcome" style="font-size: 100px;"> Welcome! Thank you for your help! </h1>
<p id="instructions" style="font-size: 1cm;"> Please enter your given ID number. <br><input type="text" id="myText"> <button type="button" onclick = "IDget()">Enter</button> <br>
  After clicking one of the experimental trial buttons please start scrolling down inside the box, when done please press finish:</p>
<br>
<button type="button" id="Start200" onclick="timer200()" style="height: 50px;">Start 200 Seconds Trial</button>
<button type="button" id="Start300" onclick="timer300()" style="height: 50px;">Start 300 Seconds Trial</button>
<br>
<canvas id="canvas" width="960" height="1000" style="border:solid black 1px;">
  Your browser does not support canvas element.
</canvas>
<br>
<button type="button" id="finish" onclick="compileAll()" style="height: 50px;">Finish</button> <br>
Log: <pre id="log" style="border: 1px solid #ccc;"></pre>

<script> 

document.getElementById("Welcome").style.fontSize="50px";
document.getElementById("instructions").style.fontSize="1cm";
document.getElementById("Start200").style.height = "100px";
document.getElementById("Start300").style.height = "100px";
document.getElementById("Start200").style.width = "480px";
document.getElementById("Start300").style.width = "480px";
document.getElementById("finish").style.height = "100px";
document.getElementById("finish").style.width = "960px";

const SHEET_ID1 = '13geD-9wkMvIYBi0VgiV6mdHxLnbiPPdgIxoso1YG_3k'; //200s
const SHEET_ID2 = '1YikCpNGi1P0Jtz3EWbWWh2C9NcUHw8TJwBWdR40ssDw'; //300s
const ACCESS_TOKEN = 'ya29.a0AfH6SMBNtpUHMFEvM0Q8CzfkfHanSL8JYpeaOfXR27P_OwvSqX_K44K5NU6_XUilvJEHxDK-dppLE7foL_CFA_j-gGQWm2PYhRSgweGA4QbN9h8oFmgcUP08Y0BFBN9jNAk7NIP1kx5XwNvJtjCRBip45PCT';

var userID=0;

function IDget(){
  userID = document.getElementById("myText").value;
  //log(userID);
}

function testing(){
  fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID2}:batchUpdate`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      //update this token with yours. 
      Authorization: `Bearer ${ACCESS_TOKEN}`,
    },
    body: JSON.stringify({
      requests: [{
        repeatCell: {
          range: {
            startColumnIndex: 0,
            endColumnIndex: 1,
            startRowIndex: 0,
            endRowIndex: 1,
            sheetId: 0
          },
          cell: {
            userEnteredValue: {
              "numberValue": 2
            },
          },
        fields: "*"
        }
      }]
    })
  })
  
}

function  updateSheetValues(index,userID,value,dataType) {
  /*
  BEFORE RUNNING:
    ---------------
    1. If not already done, enable the Google Sheets API
       and check the quota for your project at
       https://console.developers.google.com/apis/api/sheets
    2. Get access keys for your application. See
       https://developers.google.com/api-client-library/javascript/start/start-js#get-access-keys-for-your-application
    3. For additional information on authentication, see
       https://developers.google.com/sheets/api/quickstart/js#step_2_set_up_the_sample
  */
  
  if (dataType==1){ //200s time data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID1}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID,
              endColumnIndex: userID+1,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
  else if (dataType==2){ //200s x coordinate data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID1}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID+1,
              endColumnIndex: userID+2,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
  else if (dataType==3){ //200s y coordinate data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID1}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID+2,
              endColumnIndex: userID+3,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
  else if (dataType==4){ //300s time data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID2}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID,
              endColumnIndex: userID+1,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
  else if (dataType==5){ //300s x coordinate data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID2}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID+1,
              endColumnIndex: userID+2,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
  else if (dataType==6){ //300s y coordinate data
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID2}:batchUpdate`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        //update this token with yours. 
        Authorization: `Bearer ${ACCESS_TOKEN}`,
      },
      body: JSON.stringify({
        requests: [{
          repeatCell: {
            range: {
              startColumnIndex: userID+2,
              endColumnIndex: userID+3,
              startRowIndex: index,
              endRowIndex: index+1,
              sheetId: 0
            },
            cell: {
              userEnteredValue: {
                "numberValue": value
              },
            },
          fields: "*"
          }
        }]
      })
    })
  }
}

function startup() {
  var el = document.getElementById("canvas");
  el.addEventListener("touchstart", handleStart, false);
  el.addEventListener("touchend", handleEnd, false);
  el.addEventListener("touchcancel", handleCancel, false);
  el.addEventListener("touchmove", handleMove, false);
}

var ongoingTouches = [];
document.addEventListener("DOMContentLoaded", startup);

function log(msg) {
  var p = document.getElementById('log');
  p.innerHTML = msg + "\n" + p.innerHTML;
}

function handleStart(evt) {
  evt.preventDefault();
  //log("touchstart.");
  var el = document.getElementById("canvas");
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;

  for (var i = 0; i < touches.length; i++) {
    //log("touchstart:" + i + "...");
    ongoingTouches.push(copyTouch(touches[i]));
    var color = colorForTouch(touches[i]);
    ctx.beginPath();
    ctx.arc(touches[i].pageX, touches[i].pageY, 4, 0, 2 * Math.PI, false);  // a circle at the start
    ctx.fillStyle = color;
    ctx.fill();
    //log("touchstart:" + i + ".");
    if (elapsed() > 200000 && t300 == 0){
      t200 = 0;
    }
    else if (elapsed() > 300000 && t200 == 0){
      t300 = 0;
    }
    /*
    if (t200 == 1) {
      recordedTime = elapsed();
      log("start recording " + recordedTime);
    }
    else if (t300 == 1){
      recordedTime = elapsed();
      log("start recording " + recordedTime);
    }
    */
  }
}

var arrtime200 = [];
var xcord200 = [];
var ycord200 = [];
var arrtime300 = [];
var xcord300 =[];
var ycord300 =[];

function handleMove(evt) {
  evt.preventDefault();
  var el = document.getElementById("canvas");
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;

  for (var i = 0; i < touches.length; i++) {
    var color = colorForTouch(touches[i]);
    var idx = ongoingTouchIndexById(touches[i].identifier);

    if (idx >= 0) {
      //log("continuing touch "+idx);
      ctx.beginPath();
      //log("ctx.moveTo(" + ongoingTouches[idx].pageX + ", " + ongoingTouches[idx].pageY + ");");
      ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
      //log("ctx.lineTo(" + touches[i].pageX + ", " + touches[i].pageY + ");");
      ctx.lineTo(touches[i].pageX, touches[i].pageY);
      ctx.lineWidth = 4;
      ctx.strokeStyle = color;
      ctx.stroke();
      ongoingTouches.splice(idx, 1, copyTouch(touches[i]));  // swap in the new touch record
      //log(".");

      if (t200 == 1) {
        recordedTime = elapsed();
        //log("recording " + recordedTime);
        arrtime200.push(recordedTime);
        xcord200.push(ongoingTouches[idx].pageX);
        ycord200.push(ongoingTouches[idx].pageY);
      }
      else if (t300 == 1){
        recordedTime = elapsed();
        //log("recording " + recordedTime);
        arrtime300.push(recordedTime);
        xcord300.push(ongoingTouches[idx].pageX);
        ycord300.push(ongoingTouches[idx].pageY);
      }
    } else {
      log("can't figure out which touch to continue");
    }
  }
}

function handleEnd(evt) {
  evt.preventDefault();
  //log("touchend");
  var el = document.getElementById("canvas");
  var ctx = el.getContext("2d");
  var touches = evt.changedTouches;

  for (var i = 0; i < touches.length; i++) {
    var color = colorForTouch(touches[i]);
    var idx = ongoingTouchIndexById(touches[i].identifier);
    
    if (idx >= 0) {  
      ctx.lineWidth = 4;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
      ctx.lineTo(touches[i].pageX, touches[i].pageY);
      ctx.fillRect(touches[i].pageX - 4, touches[i].pageY - 4, 8, 8);  // add a square at the end
      ongoingTouches.splice(idx, 1);  // remove it; we're done

      if (t200 == 1) {
        recordedTime = elapsed();
        log("end recorded " + recordedTime);
        //record to json w/ coordinates
      }
      else if (t300 == 1){
        recordedTime = elapsed();
        log("end recorded " + recordedTime);
        //record to json w/ coordinates
      }
    } else {
      log("can't figure out which touch to end");
    }
  }
}

function handleCancel(evt) {
  evt.preventDefault();
  log("touchcancel.");
  var touches = evt.changedTouches;
  for (var i = 0; i < touches.length; i++) {
    var idx = ongoingTouchIndexById(touches[i].identifier);
    ongoingTouches.splice(idx, 1);  // remove it; we're done
  }
}

function ongoingTouchIndexById(idToFind) {
  for (var i = 0; i < ongoingTouches.length; i++) {
    var id = ongoingTouches[i].identifier;

    if (id == idToFind) {
      return i;
    }
  }
  return -1;    // not found
}

function colorForTouch(touch) {
  var r = touch.identifier % 16;
  var g = Math.floor(touch.identifier / 3) % 16;
  var b = Math.floor(touch.identifier / 7) % 16;
  r = r.toString(16); // make it a hex digit
  g = g.toString(16); // make it a hex digit
  b = b.toString(16); // make it a hex digit
  var color = "#ffffff"; // + r + g + b; //changed to white bc of y-offset inaccuracy
  //log("color for touch with identifier " + touch.identifier + " = " + color);
  return color;
}

function copyTouch({ identifier, pageX, pageY }) {
  return { identifier, pageX, pageY };
}


var prevTime = Date.now(); //global folly time
var recordedTime = Date.now();
var t200 = 0; //bool
var t300 = 0; //bool

function timer200(){
  var x = document.getElementById("Start200");
  x.disabled = true;
  t200 = 1;
  if (t300 == 1 && t200 == 1){
    log("Error, please press one button at a time.");
    y.disabled = false;
    x.disabled = false;
  }
  else{
    prevTime = Date.now();
    setTimeout(function(){ alert("The 200 Seconds is up!"); }, 200000);
  }
}

function timer300(){
  var y = document.getElementById("Start300");
  y.disabled = true;
  t300 = 1;
  if (t300 == 1 && t200 == 1){
    log("Error, please press one button at a time.");
    y.disabled = false;
    x.disabled = false;
  }
  else{
    prevTime = Date.now();
    setTimeout(function(){ alert("The 300 Seconds is up!"); }, 300000);
  }
}

function elapsed(){
  timediff = Date.now() - prevTime;
  return timediff;
}

function compileAll(){
  seconds = Math.floor(arrtime200.length/1000);
  for(var i = 0;i<arrtime200.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,arrtime200[i],1);
    }
  }
  for(var i = 0;i<xcord200.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,xcord200[i],2);
    }
  }
  for(var i = 0;i<ycord200.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,ycord200[i],3);
    }
  }
  for(var i = 0;i<arrtime300.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,arrtime300[i],4);
    }
  }
  for(var i = 0;i<xcord300.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,xcord300[i],5);
    }
  }
  for(var i = 0;i<ycord300.length;i++){
    if(i==(i*seconds)){
      updateSheetValues(i,userID,ycord300[i],6);
    }
  }
}
// Record to json file with coordinates and time stamps
// once timer runs out push to git

</script>

</body></html>